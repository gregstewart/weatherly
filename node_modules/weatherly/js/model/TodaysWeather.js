    'use strict';

    var TemperatureConverter = require('weatherly/js/model/TemperatureConverter');

    var TodaysWeather = Backbone.Model.extend({
        initialize: function () {
            this.temperatureConverter = new TemperatureConverter();

            this.attributes.temperature = this.temperatureConverter.convert(this.get('country'), this.get('temperature'));
            this.attributes.apparentTemperature = this.temperatureConverter.convert(this.get('country'), this.get('apparentTemperature'));

            this.on('change:temperature', this.temperatureChanged, this);
            this.on('change:apparentTemperature', this.apparentTemperatureChanged, this);
            this.on('change:country', this.countryHasChanged, this);
        },
        temperatureChanged: function () {
            this.attributes.temperature = this.temperatureConverter.convert(this.get('country'), this.get('temperature'));
        },
        apparentTemperatureChanged: function () {
            this.attributes.apparentTemperature = this.temperatureConverter.convert(this.get('country'), this.get('apparentTemperature'));
        },
        countryHasChanged: function () {
            if (this._previousAttributes.country !== this.get('country')) {
                if (this.temperatureConverter.shouldConvertToCelsius(this.get('country'))) {
                    this.attributes.temperature = this.temperatureConverter.toCelsius(this.get('temperature'));
                    this.attributes.apparentTemperature = this.temperatureConverter.toCelsius(this.get('apparentTemperature'));
                } else {
                    this.attributes.temperature = this.temperatureConverter.toFahrenheit(this.get('temperature'));
                    this.attributes.apparentTemperature = this.temperatureConverter.toFahrenheit(this.get('apparentTemperature'));
                }
            }
        }
    });

    module.exports = TodaysWeather;